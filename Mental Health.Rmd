---
title: "Mental Health"
author: 'Cohort B: Alvaro Chinchayan, Leighton Li, Andrey Lifar, Yoki Liu, Yue Ping, Sherry Zuo'
subtitle: Capstone Project
date: "2/27/2020"
output:
  pdf_document:
    latex_engine: xelatex
---

Our main goal is to answer questions for:  
What's the overview of people's mental health problem?   
Can you predict whether a patient should be treated of his/her mental illness or not according to the value obtained based on our data?   
Is there a correlation between mental health and whether job lets them take them break/ alow them to work from home/remote worker?  
What can we get for the tweets data?   
```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(ggplot2)
library(dplyr)
library(scales)
library(lubridate)
library(data.table)
library(skimr)
library(rtweet)
library(tidytext)
library(maps)
```
Our first part will focus on the [OSMI Mental Health in Tech Surveys data](https://osmihelp.org/research)  
We merged 2016-2019 data into a new dataset by python, more code could see in the Mental_Health.ipynb file. We will use the merged dataset "mental_health" to do an overview of the mental illness    
We will do supervised machine learning focus on the year 2014 data  

***
Data Loading  
```{r}
#import data
data<-read_csv("~/Desktop/mental_health.csv")
data2014<-read_csv("~/Desktop/2014.csv")
```
***
Data Cleaning
```{r}
#remove first column since it's just the numbers of row
data<-data[,2:29]
```
```{r}
skim(data)
```
```{r}
#rename columns
names(data2014)[5:27]<-c("state","self_employed","family_history","awareness_of_treatment", "interfere","company_size","remote","tech_company","mh_benefits","awareness_mh_benefits","mh_discuss","mh_resources", "anonymity_protected", "medical_leave_easy","mh_negative_consequence_flag","ph_negative_consequence_flag","mh_disscuss_coworker","mh_disscuss_supervisor","interview_mh_bringup", "interview_ph_bringup","mh_serious_ph","witness_mh_nc","comments")
```
```{r}
skim(data2014)
```
```{r}
#make a copy of our data
maindata<-data2014
#drop variables "Timestamp", “Country”, “comments” just to make our lives easier.
maindata<-subset(maindata, select = -c(1,4,27))
```
```{r}
names(maindata)[1:2]<-c("age","gender")
```
```{r}
data.table(maindata)
```

```{r}
skim(maindata)
```
```{r}
#make word into lowercases in column gender
maindata$gender<-str_to_lower(maindata$gender)
#build gender group
male_str = c("male", "m", "male-ish", "maile", "mal", "male (cis)", "make", "male ", "man","msle", "mail", "malr","cis man", "Cis Male", "cis male")
trans_str = c("trans-female", "something kinda male?", "queer/she/they", "non-binary","nah", "all", "enby", "fluid", "genderqueer", "androgyne", "agender", "male leaning androgynous", "guy (-ish) ^_^", "trans woman", "neuter", "female (trans)", "queer", "ostensibly male, unsure what that really means")          
female_str = c("cis female", "f", "female", "woman",  "femake", "female ","cis-female/femme", "female (cis)", "femail")
#replace details
maindata$gender <- ifelse(maindata$gender %in% male_str, "M",ifelse(maindata$gender %in% female_str,"F",ifelse(maindata$gender %in% trans_str,"T",NA)))
```
```{r}
#we want to focus on the US
maindata<-maindata[!is.na(maindata$state),]
```
```{r}
#remove other NAs
maindata<-na.omit(maindata)
```
```{r}
skim(maindata)
```
```{r}
#there is one person list 329, so delete this row
maindata<-maindata[maindata$age!=329,]
```
```{r}
names(maindata)
```

```{r}
maindata%>%
  ggplot(aes(x=age))+
  geom_bar(fill="red")+
  labs(title="Age Distribution", x="Age", y="Number of People")+
  theme(panel.background = element_rect(fill="transparent"),
        axis.line = element_line(colour = "black"))
# maindata%>%
#   group_by(age)%>%
#   tally() %>%
#   ggplot(aes(x=age,y = n))+
#   geom_bar(stat = 'identity', fill="red")+
#   labs(title="Age Distribution", x="Age", y="Number of People")+
#   theme(panel.background = element_rect(fill="transparent"), 
#         axis.line = element_line(colour = "black")) +
#   geom_text(aes(label = n))
```
```{r}
a=table(maindata$gender)
a
```
```{r}
str(a)
gender_count<-as.vector(a)
gender_percentage<-c("Female","Male","Transgender")
gender_count
gender_percentage
```
```{r}
pct1 <- round(gender_count/sum(gender_count)*100)
gender_percentage <- paste(gender_percentage, pct1) # add percents to labels
gender_percentage <- paste(gender_percentage,"%",sep="") # ad % to labels
pie(gender_count,labels = gender_percentage, col=rainbow(length(gender_percentage)),
   main="Pie Chart of Gender")
```
```{r}
#state could make a map, still considering
```
```{r}
b=table(maindata$self_employed)
b
```
```{r}
str(b)
self_employed_count<-as.vector(b)
self_employed_percentage<-names(b)
self_employed_count
self_employed_percentage
```
```{r}
pct2 <- round(self_employed_count/sum(self_employed_count)*100)
self_employed_percentage <- paste(self_employed_percentage, pct2) # add percents to labels
self_employed_percentage <- paste(self_employed_percentage,"%",sep="") # ad % to labels
pie(self_employed_count,labels = self_employed_percentage, col=rainbow(length(self_employed_percentage)),
   main="Pie Chart of Self_Employed")
```
```{r}
c=table(maindata$family_history)
c
```
```{r}
str(c)
family_history_count<-as.vector(c)
family_history_percentage<-names(c)
family_history_count
family_history_percentage
```
```{r}
pct3 <- round(family_history_count/sum(family_history_count)*100)
family_history_percentage <- paste(family_history_percentage, pct3) # add percents to labels
family_history_percentage <- paste(family_history_percentage,"%",sep="") # ad % to labels
pie(family_history_count,labels = family_history_percentage, col=rainbow(length(family_history_percentage)),
   main="Pie Chart of Family History of Mental Health")
```
```{r}
#Our outcome varaible
d=table(maindata$awareness_of_treatment)
d
```
```{r}
str(d)
awareness_of_treatment_count<-as.vector(d)
awareness_of_treatment_percentage<-names(d)
awareness_of_treatment_count
awareness_of_treatment_percentage
```
```{r}
pct4 <- round(awareness_of_treatment_count/sum(awareness_of_treatment_count)*100)
awareness_of_treatment_percentage <- paste(awareness_of_treatment_percentage, pct4) # add percents to labels
awareness_of_treatment_percentage <- paste(awareness_of_treatment_percentage,"%",sep="") # ad % to labels
pie(awareness_of_treatment_count,labels = awareness_of_treatment_percentage, col=rainbow(length(awareness_of_treatment_percentage)),
   main="Pie Chart of Awareness of Treatment")
```



